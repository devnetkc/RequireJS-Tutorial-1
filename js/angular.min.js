!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("angular-file",["exports","@angular/core","@angular/common"],t):t((e=e||self)["angular-file"]={},e.ng.core,e.ng.common)}(this,(function(e,t,n){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function r(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function o(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}function a(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var s=function(e){var t=e.getAttribute("type");return"input"===e.tagName.toLowerCase()&&t&&"file"===t.toLowerCase()},l=0,p=0,f=function(){var e=document.createElement("input");return e.type="file",e};function u(e,t){return c(e,!0).then((function(n){var i=document.createElement("canvas"),r=document.createElement("img");return new Promise((function(o,a){r.onload=function(){try{i.width=t.orientation>4?r.height:r.width,i.height=t.orientation>4?r.width:r.height;var n=i.getContext("2d");!function(e,t,n,i){switch(t){case 2:return e.transform(-1,0,0,1,n,0);case 3:return e.transform(-1,0,0,-1,n,i);case 4:return e.transform(1,0,0,-1,0,i);case 5:return e.transform(0,1,1,0,0,0);case 6:return e.transform(0,1,-1,0,i,0);case 7:return e.transform(0,-1,-1,0,i,n);case 8:e.transform(0,-1,1,0,0,n)}}(n,t.orientation,r.width,r.height),n.drawImage(r,0,0);var s=i.toDataURL(e.type||"image/WebP",.934),l=function(e){for(var t="",n=new Uint8Array(e),i=n.byteLength,r=0;r<i;r++)t+=String.fromCharCode(n[r]);return window.btoa(t)}(t.fixedArrayBuffer),p=function(e,t,n){for(var i=e.split(","),r=i[0].match(/:(.*?);/),o=r?r[1]:"text/plain",a=atob(i[1]),s=a.length,l=new Uint8Array(s);s--;)l[s]=a.charCodeAt(s);var p=new window.Blob([l],{type:o});return p.name=t,p.$ngfOrigSize=n,p}(s={KEY_STR:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode64:function(e){var t,n,i,r,o,a="",s="",l="",p=0;do{i=(t=e[p++])>>2,r=(3&t)<<4|(n=e[p++])>>4,o=(15&n)<<2|(s=e[p++])>>6,l=63&s,isNaN(n)?o=l=64:isNaN(s)&&(l=64),a=a+this.KEY_STR.charAt(i)+this.KEY_STR.charAt(r)+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(l),t=n=s="",i=r=o=l=""}while(p<e.length);return a},restore:function(e,t){e.match("data:image/jpeg;base64,")&&(e=e.replace("data:image/jpeg;base64,",""));var n=this.decode64(e),i=this.slice2Segments(n),r=this.exifManipulation(t,i);return"data:image/jpeg;base64,"+this.encode64(r)},exifManipulation:function(e,t){var n=this.getExifArray(t),i=this.insertExif(e,n);return new Uint8Array(i)},getExifArray:function(e){for(var t,n=0;n<e.length;n++)if(255===(t=e[n])[0]&&225===t[1])return t;return[]},insertExif:function(e,t){var n=e.replace("data:image/jpeg;base64,",""),i=this.decode64(n),r=i.indexOf(255,3),o=i.slice(0,r),a=i.slice(r),s=o;return s=(s=s.concat(t)).concat(a)},slice2Segments:function(e){for(var t=0,n=[];255!==e[t]||218!==e[t+1];){if(255===e[t]&&216===e[t+1])t+=2;else{var i=t+(256*e[t+2]+e[t+3])+2,r=e.slice(t,i);n.push(r),t=i}if(t>e.length)break}return n},decode64:function(e){var t,n,i,r,o="",a="",s=0,l=[];/[^A-Za-z0-9\+\/\=]/g.exec(e)&&console.log("There were invalid base64 characters in the input text."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=this.KEY_STR.indexOf(e.charAt(s++))<<2|(i=this.KEY_STR.indexOf(e.charAt(s++)))>>4,n=(15&i)<<4|(r=this.KEY_STR.indexOf(e.charAt(s++)))>>2,o=(3&r)<<6|(a=this.KEY_STR.indexOf(e.charAt(s++))),l.push(t),64!==r&&l.push(n),64!==a&&l.push(o),t=n=o="",i=r=a=""}while(s<e.length);return l}}.restore(l,s),e.name),f=(u=p,h=e.name,(c=u).lastModifiedDate=new Date,c.name=h,u);o(f)}catch(e){a(e)}var u,h,c},r.onerror=a,r.src=n}))}))}function h(e){return 0!==e.type.indexOf("image/jpeg")?Promise.resolve(e):function(e){return new Promise((function(t,n){var i=new FileReader,r=e.slice?e.slice(0,65536):e;i.readAsArrayBuffer(r),i.onerror=n,i.onload=function(e){var n={orientation:1},i=new DataView(this.result);if(65496!==i.getUint16(0,!1))return t(n);for(var r=i.byteLength,o=2;o<r;){var a=i.getUint16(o,!1);if(o+=2,65505===a){if(1165519206!==i.getUint32(o+=2,!1))return t(n);var s=18761===i.getUint16(o+=6,!1);o+=i.getUint32(o+4,s);var l=i.getUint16(o,s);o+=2;for(var p=0;p<l;p++)if(274===i.getUint16(o+12*p,s)){var f=i.getUint16(o+12*p+8,s);return f>=2&&f<=8&&(i.setUint16(o+12*p+8,1,s),n.fixedArrayBuffer=e.target.result),n.orientation=f,t(n)}}else{if(65280!=(65280&a))break;o+=i.getUint16(o,!1)}}return t(n)}}))}(e).then((function(t){return t.orientation<2||t.orientation>8?e:u(e,t)}))}function c(e,t){if(!e)return Promise.resolve(e);if(t&&null!=e.$ngfDataUrl||!t&&null!=e.$ngfBlobUrl)return Promise.resolve(t?e.$ngfDataUrl:e.$ngfBlobUrl);var n=t?e.$$ngfDataUrlPromise:e.$$ngfBlobUrlPromise;if(n)return n;var i,r=window;if(!r.FileReader||!e||r.FileAPI&&-1!==navigator.userAgent.indexOf("MSIE 8")&&!(e.size<2e4)||r.FileAPI&&-1!==navigator.userAgent.indexOf("MSIE 9")&&!(e.size<4e6))return e[t?"$ngfDataUrl":"$ngfBlobUrl"]="",Promise.reject(new Error("Browser does not support window.FileReader, window.FileReader, or window.FileAPI"));var o=r.URL||r.webkitURL;if(FileReader)i=new Promise((function(t,n){var i=new FileReader;i.onload=function(n){e.$ngfDataUrl=n.target.result,delete e.$ngfDataUrl,t(n.target.result)},i.onerror=function(t){e.$ngfDataUrl="",n(t)},i.readAsDataURL(e)}));else{var a;try{a=o.createObjectURL(e)}catch(e){return Promise.reject(e)}i=Promise.resolve(a),e.$ngfBlobUrl=a}return n=(n=t?e.$$ngfDataUrlPromise=i:e.$$ngfBlobUrlPromise=i).then((function(n){return delete e[t?"$$ngfDataUrlPromise":"$$ngfBlobUrlPromise"],n}))}var g=function(){function e(e){this.element=e,this.filters=[],this.lastFileCount=0,this.ngfFixOrientation=!0,this.fileDropDisabled=!1,this.selectable=!1,this.directiveInit=new t.EventEmitter,this.lastInvalids=[],this.lastInvalidsChange=new t.EventEmitter,this.lastBaseUrlChange=new t.EventEmitter,this.fileChange=new t.EventEmitter,this.files=[],this.filesChange=new t.EventEmitter,this.initFilters()}return e.prototype.initFilters=function(){this.filters.push({name:"accept",fn:this._acceptFilter}),this.filters.push({name:"fileSize",fn:this._fileSizeFilter})},e.prototype.ngOnDestroy=function(){delete this.fileElm},e.prototype.ngOnInit=function(){var e=this;this.selectable&&this.enableSelecting(),this.multiple&&this.paramFileElm().setAttribute("multiple",this.multiple),setTimeout((function(){e.directiveInit.emit(e)}),0)},e.prototype.ngOnChanges=function(e){e.accept&&this.paramFileElm().setAttribute("accept",e.accept.currentValue||"*")},e.prototype.paramFileElm=function(){if(this.fileElm)return this.fileElm;if(s(this.element.nativeElement))return this.fileElm=this.element.nativeElement;var e=function(){var e=f(),t=document.createElement("label");return t.innerHTML="upload",t.style.visibility="hidden",t.style.position="absolute",t.style.overflow="hidden",t.style.width="0px",t.style.height="0px",t.style.border="none",t.style.margin="0px",t.style.padding="0px",t.setAttribute("tabindex","-1"),t.appendChild(e),t}();return this.fileElm=e.getElementsByTagName("input")[0],this.fileElm.addEventListener("change",this.changeFn.bind(this)),this.element.nativeElement.appendChild(e),this.fileElm},e.prototype.enableSelecting=function(){var e=this,t=this.element.nativeElement;if(s(t)){var n=function(t){return e.beforeSelect()};return t.addEventListener("click",n),void t.addEventListener("touchstart",n)}var i=function(t){return e.clickHandler(t)};t.addEventListener("click",i),t.addEventListener("touchstart",i),t.addEventListener("touchend",i)},e.prototype.getValidFiles=function(e){for(var t=[],n=e.length-1;n>=0;--n)this.isFileValid(e[n])&&t.push(e[n]);return t},e.prototype.getInvalidFiles=function(e){for(var t=[],n=e.length-1;n>=0;--n){var i=this.getFileFilterFailName(e[n]);i&&t.push({file:e[n],type:i})}return t},e.prototype.handleFiles=function(e){var t=this,n=this.getValidFiles(e);e.length!=n.length?this.lastInvalids=this.getInvalidFiles(e):delete this.lastInvalids,this.lastInvalidsChange.emit(this.lastInvalids),n.length&&(this.ngfFixOrientation?this.applyExifRotations(n).then((function(e){return t.que(e)})):this.que(n)),this.isEmptyAfterSelection()&&(this.element.nativeElement.value="")},e.prototype.que=function(e){var t=this;this.files=this.files||[],Array.prototype.push.apply(this.files,e),this.filesChange.emit(this.files),e.length&&(this.fileChange.emit(this.file=e[0]),this.lastBaseUrlChange.observers.length&&c(e[0]).then((function(e){return t.lastBaseUrlChange.emit(e)}))),this.lastFileCount=this.files.length},e.prototype.changeFn=function(e){var t=e.__files_||e.target&&e.target.files;t&&(this.stopEvent(e),this.handleFiles(t))},e.prototype.clickHandler=function(e){if(this.element.nativeElement.getAttribute("disabled")||this.fileDropDisabled)return!1;var t=function(e){var t=e.changedTouches||e.originalEvent&&e.originalEvent.changedTouches;if(t){if("touchstart"===e.type)return p=t[0].clientX,l=t[0].clientY,!0;if("touchend"===e.type){var n=t[0].clientX,i=t[0].clientY;if(Math.abs(n-p)>20||Math.abs(i-l)>20)return e.stopPropagation(),e.cancelable&&e.preventDefault(),!1}return!0}return!1}(e);return!1!==t?t:(this.paramFileElm().click(),this.beforeSelect(),!1)},e.prototype.beforeSelect=function(){this.files&&this.lastFileCount===this.files.length||(this.fileElm.value=null)},e.prototype.isEmptyAfterSelection=function(){return!!this.element.nativeElement.attributes.multiple},e.prototype.eventToTransfer=function(e){return e.dataTransfer?e.dataTransfer:e.originalEvent?e.originalEvent.dataTransfer:null},e.prototype.stopEvent=function(e){e.preventDefault(),e.stopPropagation()},e.prototype.transferHasFiles=function(e){return!!e.types&&(e.types.indexOf?-1!==e.types.indexOf("Files"):!!e.types.contains&&e.types.contains("Files"))},e.prototype.eventToFiles=function(e){var t=this.eventToTransfer(e);if(t){if(t.files&&t.files.length)return t.files;if(t.items&&t.items.length)return t.items}return[]},e.prototype.applyExifRotations=function(e){for(var t=function(t,n){return h(t).then((function(t){return e.splice(n,1,t)}))},n=[],i=e.length-1;i>=0;--i)n[i]=t(e[i],i);return Promise.all(n).then((function(){return e}))},e.prototype.onChange=function(e){var t=this.element.nativeElement.files||this.eventToFiles(e);t.length&&(this.stopEvent(e),this.handleFiles(t))},e.prototype.getFileFilterFailName=function(e){for(var t=0;t<this.filters.length;t++)if(!this.filters[t].fn.call(this,e))return this.filters[t].name},e.prototype.isFileValid=function(e){return!(this.accept||this.filters&&this.filters.length)||!this.getFileFilterFailName(e)},e.prototype.isFilesValid=function(e){for(var t=e.length-1;t>=0;--t)if(!this.isFileValid(e[t]))return!1;return!0},e.prototype._acceptFilter=function(e){return function(e,t,n){if(!e)return!0;for(var i,r,o=e.split(","),a=o.length-1;a>=0;--a){if(r=(r=(r=o[a]).replace(/(^\s+|\s+$)/g,"")).replace(/\*/g,".*"),i=new RegExp(r,"gi"),t.search(i)>=0)return!0;if("."==r.substring(0,1)&&(r="\\"+r,i=new RegExp(r+"$","i"),(n||t).search(i)>=0))return!0}return!1}(this.accept,e.type,e.name)},e.prototype._fileSizeFilter=function(e){return!(this.maxSize&&e.size>this.maxSize)},e.prototype.filesToWriteableObject=function(e){for(var t=[],n=0;n<e.length;++n)t.push({type:e[n].type,kind:e[n].kind});return t},e.ctorParameters=function(){return[{type:t.ElementRef}]},o([t.Input(),a("design:type",String)],e.prototype,"multiple",void 0),o([t.Input(),a("design:type",String)],e.prototype,"accept",void 0),o([t.Input(),a("design:type",Number)],e.prototype,"maxSize",void 0),o([t.Input(),a("design:type",Boolean)],e.prototype,"ngfFixOrientation",void 0),o([t.Input(),a("design:type",Boolean)],e.prototype,"fileDropDisabled",void 0),o([t.Input(),a("design:type",Boolean)],e.prototype,"selectable",void 0),o([t.Output("init"),a("design:type",t.EventEmitter)],e.prototype,"directiveInit",void 0),o([t.Input(),a("design:type",Array)],e.prototype,"lastInvalids",void 0),o([t.Output(),a("design:type",t.EventEmitter)],e.prototype,"lastInvalidsChange",void 0),o([t.Input(),a("design:type",String)],e.prototype,"lastBaseUrl",void 0),o([t.Output(),a("design:type",t.EventEmitter)],e.prototype,"lastBaseUrlChange",void 0),o([t.Input(),a("design:type",File)],e.prototype,"file",void 0),o([t.Output(),a("design:type",t.EventEmitter)],e.prototype,"fileChange",void 0),o([t.Input(),a("design:type",Array)],e.prototype,"files",void 0),o([t.Output(),a("design:type",t.EventEmitter)],e.prototype,"filesChange",void 0),o([t.HostListener("change",["$event"]),a("design:type",Function),a("design:paramtypes",[Event]),a("design:returntype",void 0)],e.prototype,"onChange",null),e=o([t.Directive({selector:"[ngf]",exportAs:"ngf"}),a("design:paramtypes",[t.ElementRef])],e)}(),d=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.selectable=!0,t}return r(n,e),o([t.Input(),a("design:type",Object)],n.prototype,"selectable",void 0),n=o([t.Directive({selector:"[ngfSelect]",exportAs:"ngfSelect"})],n)}(g),v=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.fileOver=new t.EventEmitter,n.validDrag=!1,n.validDragChange=new t.EventEmitter,n.invalidDrag=!1,n.invalidDragChange=new t.EventEmitter,n.dragFilesChange=new t.EventEmitter,n}return r(n,e),n.prototype.onDrop=function(e){if(this.fileDropDisabled)this.stopEvent(e);else{this.closeDrags();var t=this.eventToFiles(e);t.length&&(this.stopEvent(e),this.handleFiles(t))}},n.prototype.handleFiles=function(t){this.fileOver.emit(!1),e.prototype.handleFiles.call(this,t)},n.prototype.onDragOver=function(e){if(this.fileDropDisabled)this.stopEvent(e);else{var t=this.eventToTransfer(e),n=this.eventToFiles(e),i=this.filesToWriteableObject(n);this.dragFilesChange.emit(this.dragFiles=i),n.length?this.validDrag=this.isFilesValid(n):this.validDrag=!0,this.validDragChange.emit(this.validDrag),this.invalidDrag=!this.validDrag,this.invalidDragChange.emit(this.invalidDrag),t.dropEffect="copy",this.stopEvent(e),this.fileOver.emit(!0)}},n.prototype.closeDrags=function(){delete this.validDrag,this.validDragChange.emit(this.validDrag),this.invalidDrag=!1,this.invalidDragChange.emit(this.invalidDrag),delete this.dragFiles,this.dragFilesChange.emit(this.dragFiles)},n.prototype.onDragLeave=function(e){this.fileDropDisabled?this.stopEvent(e):(this.closeDrags(),this.element&&e.currentTarget===this.element[0]||(this.stopEvent(e),this.fileOver.emit(!1)))},o([t.Output(),a("design:type",t.EventEmitter)],n.prototype,"fileOver",void 0),o([t.Input(),a("design:type",Boolean)],n.prototype,"validDrag",void 0),o([t.Output(),a("design:type",t.EventEmitter)],n.prototype,"validDragChange",void 0),o([t.Input(),a("design:type",Object)],n.prototype,"invalidDrag",void 0),o([t.Output(),a("design:type",t.EventEmitter)],n.prototype,"invalidDragChange",void 0),o([t.Input(),a("design:type",Array)],n.prototype,"dragFiles",void 0),o([t.Output(),a("design:type",t.EventEmitter)],n.prototype,"dragFilesChange",void 0),o([t.HostListener("drop",["$event"]),a("design:type",Function),a("design:paramtypes",[Event]),a("design:returntype",void 0)],n.prototype,"onDrop",null),o([t.HostListener("dragover",["$event"]),a("design:type",Function),a("design:paramtypes",[Event]),a("design:returntype",void 0)],n.prototype,"onDragOver",null),o([t.HostListener("dragleave",["$event"]),a("design:type",Function),a("design:paramtypes",[Event]),a("design:returntype",Object)],n.prototype,"onDragLeave",null),n=o([t.Directive({selector:"[ngfDrop]",exportAs:"ngfDrop"})],n)}(g),m=function(){function e(e){this.ElementRef=e}return e.prototype.ngOnChanges=function(e){var t=this;c(this.file).then((function(e){var n="url('"+(e||"")+"')";t.ElementRef.nativeElement.style.backgroundImage=n}))},e.ctorParameters=function(){return[{type:t.ElementRef}]},o([t.Input("ngfBackground"),a("design:type",Object)],e.prototype,"file",void 0),e=o([t.Directive({selector:"[ngfBackground]"}),a("design:paramtypes",[t.ElementRef])],e)}(),y=function(){function e(){this.percent=0,this.percentChange=new t.EventEmitter}return e.prototype.ngOnChanges=function(e){var t=this;if(e.httpEvent&&e.httpEvent.currentValue){var n=e.httpEvent.currentValue;n.loaded&&n.total&&setTimeout((function(){t.percent=Math.round(100*n.loaded/n.total),t.percentChange.emit(t.percent)}),0)}},o([t.Input(),a("design:type",Number)],e.prototype,"percent",void 0),o([t.Output(),a("design:type",t.EventEmitter)],e.prototype,"percentChange",void 0),o([t.Input(),a("design:type",Event)],e.prototype,"httpEvent",void 0),e=o([t.Directive({selector:"ngfUploadStatus"})],e)}(),E=function(){function e(e){this.postName="file",this.FormData=new FormData,this.FormDataChange=new t.EventEmitter,this.differ=e.find([]).create()}return e.prototype.ngDoCheck=function(){var e=this;this.differ.diff(this.files)&&setTimeout((function(){return e.buildFormData()}),0)},e.prototype.buildFormData=function(){var e=this;"object"==typeof this.files&&this.files.constructor===Array?(this.FormData=new FormData,(this.files||[]).forEach((function(t){return e.FormData.append(e.postName,t,e.fileName||t.name)})),this.FormDataChange.emit(this.FormData)):delete this.FormData},e.ctorParameters=function(){return[{type:t.IterableDiffers}]},o([t.Input(),a("design:type",Array)],e.prototype,"files",void 0),o([t.Input(),a("design:type",String)],e.prototype,"postName",void 0),o([t.Input(),a("design:type",String)],e.prototype,"fileName",void 0),o([t.Input(),a("design:type",FormData)],e.prototype,"FormData",void 0),o([t.Output(),a("design:type",t.EventEmitter)],e.prototype,"FormDataChange",void 0),e=o([t.Directive({selector:"ngfFormData"}),a("design:paramtypes",[t.IterableDiffers])],e)}(),D=function(){function e(e){this.ElementRef=e}return e.prototype.ngOnChanges=function(e){var t=this;c(this.file).then((function(e){return t.ElementRef.nativeElement.src=e}))},e.ctorParameters=function(){return[{type:t.ElementRef}]},o([t.Input("ngfSrc"),a("design:type",Object)],e.prototype,"file",void 0),e=o([t.Directive({selector:"[ngfSrc]"}),a("design:paramtypes",[t.ElementRef])],e)}(),F=[v,d,m,D,y,E,g],b=function(){function e(){}return e=o([t.NgModule({imports:[n.CommonModule],declarations:F,exports:F})],e)}();e.ngf=g,e.ngfBackground=m,e.ngfDrop=v,e.ngfFormData=E,e.ngfModule=b,e.ngfSelect=d,e.ngfSrc=D,e.ngfUploadStatus=y,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-file.umd.min.js.map